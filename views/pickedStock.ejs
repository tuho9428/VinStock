<%- include("partials/header.ejs") %>

<h2><%= symbol %></h2>
<div>
  <label for="timeSerie">Time Serie:</label>
  <div id="timeSerie">
    <%= timeSerie %>
  </div>

<!-- Add the div element for the Google Candlestick Chart -->
<div id="googleCandlestickChart" style="width: 850px; height: 500px;"></div>

<form id="myForm" method="post" action='/result?symbol=<%=symbol%>' class="button-container">
  <button type="submit" name="dailyPrice" value="Get Daily Price" onclick="displayClickedButton(this)">Daily</button>
  <button type="submit" name="intradayPrice" value="Get Intraday Price" onclick="displayClickedButton(this)">Intraday</button>
  <button type="submit" name="weeklyPrice" value="Get Weekly Price" onclick="displayClickedButton(this)">Weekly</button>
  <button type="submit" name="monthlyPrice" value="Get Monthly Price" onclick="displayClickedButton(this)">Monthly</button>
  <button type="submit" name="companyOverview" value="Get Company Overview" onclick="displayClickedButton(this)">Company Overview</button>
  <button type="submit" name="incomeStatement" value="Get Income Statement" onclick="displayClickedButton(this)">Income Statement</button>
</form>

<form id="addForm" method="POST" action='/add?symbol=<%=symbol%>' class="button-container">
  <button type="submit" name="add" value="<%=symbol%>">Add to List</button>
</form>

<div class="response-area">
  <% if (Array.isArray(content) && content.length > 0) { %>
    <!-- Add the JavaScript code to render the Google Candlestick Chart -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', '');
        data.addColumn('number', '');
        data.addColumn('number', '');
        data.addColumn('number', '');
        data.addColumn('number', '');

        var candlestickData = [];
        <% content.slice(0, 52).reverse().forEach((price) => { %>
          candlestickData.push(['<%= price.timestamp %>', <%= price.lowPrice || 0 %>, <%= price.openPrice || 0 %>, <%= price.closePrice || 0 %>, <%= price.highPrice || 0 %>]);
        <% }) %>

        data.addRows(candlestickData);

        var options = {
          legend: 'none',
          animation: {startup: true, duration: 1000, easing:'inAndOut'},
          candlestick: {
            fallingColor: { strokeWidth: 1, fill:'#a52714', stroke: '#a52714', hollowIsRising: true }, // red candles
            risingColor: { strokeWidth: 1, fill:'#0f9d58', stroke: '#0f9d58' }, // green candles
          }
        };

        var chart = new google.visualization.CandlestickChart(document.getElementById('googleCandlestickChart'));
        chart.draw(data, options);
      }
    </script>

  <% } else { %>
    <% if (content && content === "Error!") { %>
      <p>Error fetching stock price data for <%= symbol %>.</p>
    <% } else { %>
      <p>No stock price data available for <%= symbol %>.</p>
    <% } %>
  <% } %>

</div>

<%- include("partials/footer.ejs") %>
