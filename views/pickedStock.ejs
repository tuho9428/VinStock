<%- include("partials/header.ejs") %>

<h1>You have picked symbol <%= symbol %></h1>
  
<form id="myForm" method="post" action='/result' class="button-container">
  <button type="submit" name="dailyPrice" value="Get Daily Price" onclick="displayClickedButton(this)">Get Daily Price</button>
  <button type="submit" name="intradayPrice" value="Get Intraday Price" onclick="displayClickedButton(this)">Get Intraday Price</button>
  <button type="submit" name="weeklyPrice" value="Get Weekly Price" onclick="displayClickedButton(this)">Get Weekly Price</button>
  <button type="submit" name="monthlyPrice" value="Get Monthly Price" onclick="displayClickedButton(this)">Get Monthly Price</button>
</form>

<h2><%= symbol %></h2>
<div>
  <label for="timeSerie">Time Serie:</label>
  <div id="timeSerie">
    <%= timeSerie %>
  </div>

<div id="clickedButtonInfo"></div>

<!-- Add the canvas element for the line chart -->
<canvas id="lineChart"></canvas>

<div class="response-area">
  <% if (Array.isArray(content) && content.length > 0) { %>
    <% content.forEach((price) => { %>
      <div>
        <label for="timestamp">Timestamp:</label>
        <div id="timestamp">
          <%= price.timestamp %>
        </div>
      </div>
      <div>
        <label for="openPrice">Open Price:</label>
        <div id="openPrice">
          <%= price.openPrice || 'N/A' %>
        </div>
      </div>
      <div>
        <label for="highPrice">High Price:</label>
        <div id="highPrice">
          <%= price.highPrice || 'N/A' %>
        </div>
      </div>
      <div>
        <label for="lowPrice">Low Price:</label>
        <div id="lowPrice">
          <%= price.lowPrice || 'N/A' %>
        </div>
      </div>
      <div>
        <label for="closePrice">Close Price:</label>
        <div id="closePrice">
          <%= price.closePrice || 'N/A' %>
        </div>
      </div>
      <div>
        <label for="volume">Volume:</label>
        <div id="volume">
          <%= price.volume || 'N/A' %>
        </div>
      </div>

      <hr>
    <% }) %>

    <!-- Add the JavaScript code to render the line chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Step 5: Extract necessary data points for the line chart
      const labels = [];
      const closePrices = [];

      <% content.forEach((price) => { %>
        labels.push('<%= price.timestamp %>');
        closePrices.push('<%= price.closePrice || 'N/A' %>');
      <% }) %>

      // Step 6: Create a new instance of the line chart
      const ctx = document.getElementById('lineChart').getContext('2d');
      const lineChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: labels,
              datasets: [{
                  label: 'Close Prices',
                  data: closePrices,
                  borderColor: 'blue',
                  fill: false
              }]
          },
          options: {
              responsive: true,
              scales: {
                  x: {
                      display: true,
                      title: {
                          display: true,
                          text: 'Timestamp'
                      },
                      grid: {
                        display: false,
                      }
                    
                  },
                  y: {
                      display: true,
                      title: {
                          display: true,
                          text: 'Close Price'
                      },
                      grid: {
                        display: false,
                      }
                  }
              }
          }
      });

      // Step 7: Render the chart on the canvas element
      lineChart.render();
    </script>

  <% } else { %>
    <% if (content && content === "Error!") { %>
      <p>Error fetching stock price data for <%= symbol %>.</p>
    <% } else { %>
      <p>No stock price data available for <%= symbol %>.</p>
    <% } %>
  <% } %>

</div>

<%- include("partials/footer.ejs") %>
